<!doctype html>
<html>
<head><meta charset="utf-8"><title>Display - Turnos</title>
<style>body{font-family: Arial; text-align:center} .big{font-size:72px}</style>
</head>
<body>
<h1>Turno Actual</h1>
<div id="current" class="big">----</div>
<h3>Siguientes</h3>
<ul id="next"></ul>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const urlParams = new URLSearchParams(location.search);
const clinicId = urlParams.get('clinic') || '1';
const socket = io('http://localhost:4000');
socket.emit('joinClinic', clinicId);

async function loadQueue(){
  const res = await fetch(`http://localhost:4000/api/turns/queue/${clinicId}`);
  const q = await res.json();
  document.getElementById('next').innerHTML='';
  if (q.length > 0) {
    document.getElementById('current').textContent = `#${q[0].Number}`;
    q.slice(1,5).forEach(t => { const li = document.createElement('li'); li.textContent = `#${t.Number}`; document.getElementById('next').appendChild(li); });
  } else {
    document.getElementById('current').textContent = '---';
  }
}

socket.on('turnCreated', loadQueue);
socket.on('turnUpdated', loadQueue);
loadQueue();
</script>
</body>
</html>
